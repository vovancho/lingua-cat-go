# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `sync.Once` –≤ Golang

–í–æ—Ç –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `sync.Once` –≤ Go, –∫–æ—Ç–æ—Ä—ã–π –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —Ä–æ–≤–Ω–æ **–æ–¥–∏–Ω —Ä–∞–∑**, –¥–∞–∂–µ –µ—Å–ª–∏ –µ—ë –≤—ã–∑—ã–≤–∞—é—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≥–æ—Ä—É—Ç–∏–Ω.

## üîπ –û—Å–Ω–æ–≤–Ω—ã–µ —Å–ª—É—á–∞–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î)
- –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–Ω–≥–ª—Ç–æ–Ω–∞ (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –æ–±—ä–µ–∫—Ç–∞)

## üìå –ü—Ä–∏–º–µ—Ä: –û–¥–Ω–æ–∫—Ä–∞—Ç–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
```go
package main

import (
	"fmt"
	"sync"
)

var (
	once     sync.Once
	instance *Database
)

// Database - –ø—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞ –æ–¥–∏–Ω —Ä–∞–∑
type Database struct {
	connection string
}

// connect –∏–º–∏—Ç–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
func connect() *Database {
	fmt.Println("Connecting to the database...")
	return &Database{connection: "postgres://user:pass@localhost/db"}
}

// getDatabaseInstance –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∏–Ω–≥–ª—Ç–æ–Ω Database
func getDatabaseInstance() *Database {
	once.Do(func() {
		instance = connect()
	})
	return instance
}

func main() {
	// –ú–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã getDatabaseInstance() –ø—Ä–∏–≤–µ–¥—É—Ç –∫ –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–º—É —Å–æ–∑–¥–∞–Ω–∏—é Database
	var wg sync.WaitGroup
	for i := 0; i < 5; i++ {
		wg.Add(1)
		go func(id int) {
			defer wg.Done()
			db := getDatabaseInstance()
			fmt.Printf("Goroutine %d: Database instance: %v\n", id, db.connection)
		}(i)
	}
	wg.Wait()
}
```

## üîπ –í—ã–≤–æ–¥ (–ø—Ä–∏–º–µ—Ä–Ω—ã–π):
```
Connecting to the database...
Goroutine 2: Database instance: postgres://user:pass@localhost/db
Goroutine 4: Database instance: postgres://user:pass@localhost/db
Goroutine 0: Database instance: postgres://user:pass@localhost/db
Goroutine 1: Database instance: postgres://user:pass@localhost/db
Goroutine 3: Database instance: postgres://user:pass@localhost/db
```

## üìå –ü—Ä–∏–º–µ—Ä: –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞
```go
var (
	configOnce sync.Once
	appConfig  map[string]string
)

func loadConfig() {
	fmt.Println("Loading config...")
	appConfig = map[string]string{
		"host": "localhost",
		"port": "8080",
	}
}

func GetConfig() map[string]string {
	configOnce.Do(loadConfig)
	return appConfig
}

func main() {
	// –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤ –∑–∞–≥—Ä—É–∑–∏—Ç –∫–æ–Ω—Ñ–∏–≥
	fmt.Println(GetConfig()["host"]) // "localhost"
	// –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥
	fmt.Println(GetConfig()["port"]) // "8080"
}
```

## üí° –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?
1. sync.Once –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω–∞—è –≤ `Do()` —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑, –¥–∞–∂–µ –µ—Å–ª–∏ `Do()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≥–æ—Ä—É—Ç–∏–Ω.
2. **–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (`mutex`) –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≥–æ–Ω–∫–∏.
3. **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã–∑–æ–≤—ã** `Do()` –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–≤—Ç–æ—Ä–Ω–æ.

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã:
- –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –≤ `Do()` –ø–∞–Ω–∏–∫—É–µ—Ç, –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã –Ω–µ –±—É–¥—É—Ç –µ—ë –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–Ω–æ–≤–∞
- **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `sync.Once` –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ)
- –î–ª—è –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π `sync.Once`

## üèÜ –ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è—Ç—å?
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—è–∂–µ–ª—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ thread-safe —Å–∏–Ω–≥–ª—Ç–æ–Ω–æ–≤

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `sync.Mutex` –∏–ª–∏ –¥—Ä—É–≥–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.
